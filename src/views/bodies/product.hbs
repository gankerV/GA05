<!-- Breadcrumbs -->
<section id="breadcrumbs" class="pt-6 bg-gray-50">
    <div class="container mx-auto px-4">
        <ol class="list-reset flex">
            <li>
                <a href="/" class="font-semibold hover:text-primary">Home</a>
            </li>
            <li><span class="mx-2">&gt;</span></li>
            <li>
                <a href="/shop" class="font-semibold hover:text-primary">Shop</a>
            </li>
            <li><span class="mx-2">&gt;</span></li>
            <li>{{product.Shop.product_name}}</li>
        </ol>
    </div>
</section>

<!-- Product info -->
<section id="product-info">
    <div class="container mx-auto">
        <div class="py-6">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Image Section -->
                <div class="w-full lg:w-1/2">
                    <div class="grid gap-4">
                        <!-- Big Image -->
                        <div id="main-image-container">
                            <img id="main-image"
                                class="h-auto w-full max-w-full rounded-lg object-cover object-center md:h-[480px]"
                                src="{{product.Shop.imageUrl}}" alt="Main Product Image" />
                        </div>
                        <!-- Small Images -->
                        <div class="grid grid-cols-5 gap-4">
                            <div>
                                <img onclick="changeImage(this)" data-full="../../../public/images/single-product/1.jpg"
                                    src="../../../public/images/single-product/1.jpg"
                                    class="object-cover object-center max-h-30 max-w-full rounded-lg cursor-pointer"
                                    alt="Gallery Image 1" />
                            </div>
                            <div>
                                <img onclick="changeImage(this)" data-full="../../../public/images/single-product/2.jpg"
                                    src="../../../public/images/single-product/2.jpg"
                                    class="object-cover object-center max-h-30 max-w-full rounded-lg cursor-pointer"
                                    alt="Gallery Image 2" />
                            </div>
                            <div>
                                <img onclick="changeImage(this)" data-full="../../../public/images/single-product/3.jpg"
                                    src="../../../public/images/single-product/3.jpg"
                                    class="object-cover object-center max-h-30 max-w-full rounded-lg cursor-pointer"
                                    alt="Gallery Image 3" />
                            </div>
                            <div>
                                <img onclick="changeImage(this)" data-full="../../../public/images/single-product/4.jpg"
                                    src="../../../public/images/single-product/4.jpg"
                                    class="object-cover object-center max-h-30 max-w-full rounded-lg cursor-pointer"
                                    alt="Gallery Image 4" />
                            </div>
                            <div>
                                <img onclick="changeImage(this)" data-full="../../../public/images/single-product/5.jpg"
                                    src="../../../public/images/single-product/5.jpg"
                                    class="object-cover object-center max-h-30 max-w-full rounded-lg cursor-pointer"
                                    alt="Gallery Image 5" />
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Product Details Section -->
                <div class="w-full lg:w-1/2 flex flex-col justify-between">
                    <div class="pb-8 border-b border-gray-line">
                        <h1 class="text-3xl font-bold mb-4">
                            {{product.Shop.product_name}}
                        </h1>
                        <div class="flex items-center mb-8">
                            <span class="ml-2">{{fullStars product.Shop.rating}}{{emptyStars
                                product.Shop.rating}}</span>
                            <a href="#review-form-place" id="write-review-link"
                                class="ml-4 text-primary font-semibold">Write a review</a>
                        </div>
                        <div class="mb-4 pb-4 border-b border-gray-line">
                            <p class="mb-2">
                                Brand:<strong><a href="#" class="hover:text-primary">
                                        {{product.Shop.brand}}</a></strong>
                            </p>
                            <p class="mb-2">
                                Product code:<strong>
                                    {{product.id}}</strong>
                            </p>
                            <p class="mb-2">
                                Availability:<strong>
                                    {{product.product_status}}</strong>
                            </p>
                        </div>
                        <div class="text-2xl font-semibold mb-8">
                            ${{product.Shop.price}}
                        </div>
                        <div class="flex items-center mb-8">
                            <button id="decrease"
                                class="bg-primary hover:bg-transparent border border-transparent hover:border-primary text-white hover:text-primary font-semibold w-10 h-10 rounded-full flex items-center justify-center focus:outline-none"
                                disabled>
                                -
                            </button>
                            <input id="quantity" type="number" value="1"
                                class="w-16 py-2 text-center focus:outline-none" readonly />
                            <button id="increase"
                                class="bg-primary hover:bg-transparent border border-transparent hover:border-primary text-white hover:text-primary font-semibold w-10 h-10 rounded-full focus:outline-none">
                                +
                            </button>
                        </div>
                        <button
                            class="bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full">
                            Add to Cart
                        </button>
                    </div>
                    <!-- Social sharing -->
                    <div class="flex space-x-4 my-6">
                        <a href="#" class="w-4 h-4 flex items-center justify-center">
                            <img src="../../../public/images/social_icons/facebook.svg" alt="Facebook"
                                class="w-4 h-4 transition-transform transform hover:scale-110" />
                        </a>
                        <a href="#" class="w-4 h-4 flex items-center justify-center">
                            <img src="../../../public/images/social_icons/instagram.svg" alt="Instagram"
                                class="w-4 h-4 transition-transform transform hover:scale-110" />
                        </a>
                        <a href="#" class="w-4 h-4 flex items-center justify-center">
                            <img src="../../../public/images/social_icons/pinterest.svg" alt="Pinterest"
                                class="w-4 h-4 transition-transform transform hover:scale-110" />
                        </a>
                        <a href="#" class="w-4 h-4 flex items-center justify-center">
                            <img src="../../../public/images/social_icons/twitter.svg" alt="Twitter"
                                class="w-4 h-4 transition-transform transform hover:scale-110" />
                        </a>
                        <a href="#" class="w-4 h-4 flex items-center justify-center">
                            <img src="../../../public/images/social_icons/viber.svg" alt="Viber"
                                class="w-4 h-4 transition-transform transform hover:scale-110" />
                        </a>
                    </div>
                    <!-- Additional Information -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">
                            Product Description
                        </h3>
                        <p>
                            {{product.description}}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product tabs description -->
<section>
    <div class="container mx-auto">
        <div class="py-12">
            <div class="mt-10">
                <div class="flex space-x-4" role="tablist">
                    <button id="description-tab" role="tab" aria-controls="description-content" aria-selected="true"
                        class="tab active">
                        Description
                    </button>
                    <button id="additional-info-tab" role="tab" aria-controls="additional-info-content"
                        aria-selected="false" class="tab">
                        Additional information
                    </button>
                    <button id="size-shape-tab" role="tab" aria-controls="size-shape-content" aria-selected="false"
                        class="tab">
                        Size & Shape
                    </button>
                    <button id="reviews-tab" role="tab" aria-controls="reviews-content" aria-selected="false"
                        class="tab">
                        Reviews ({{product.reviews.length}})
                    </button>
                </div>
                <div class="mt-8">
                    <div id="description-content" role="tabpanel" aria-labelledby="description-tab" class="tab-content">
                        <div class="flex flex-col lg:flex-row lg:space-x-8">
                            <div class="w-full lg:w-1/2">
                                <h3 class="text-xl font-semibold mb-2">
                                    With the new fashion trends and all the
                                    available shopping options, you can order
                                    your clothes online and make money without
                                    even leaving your house.
                                </h3>
                                <p class="mb-4">
                                    These days, you can take your own
                                    inspiration and create something new for
                                    yourself. All you need to do is read books
                                    and magazines about fashion, watch videos on
                                    YouTube, keep yourself updated on social
                                    media, and, of course, shop online!
                                </p>
                            </div>
                            <div class="w-full lg:w-1/4">
                                <h3 class="text-xl font-semibold mb-5">
                                    Material & Washing
                                </h3>
                                <p class="mb-2 pb-2 border-b border-gray-line">
                                    Material:
                                    <span class="font-semibold">100% cotton</span>
                                </p>
                                <p class="mb-2 pb-2 border-b border-gray-line">
                                    Fabric:
                                    <span class="font-semibold">Soft jersey</span>
                                </p>
                                <p class="mb-2">
                                    Care instructions:
                                    <span class="font-semibold">Machine wash at
                                        30°C, do not tumble dry, iron on low
                                        heat, do not bleach</span>
                                </p>
                            </div>
                            <div class="w-full lg:w-1/4">
                                <h3 class="text-xl font-semibold mb-5">
                                    Size & Shape
                                </h3>
                                <p class="mb-2 pb-2 border-b border-gray-line">
                                    Model height:
                                    <span class="font-semibold">Our model is 180
                                        cm tall and is wearing size M</span>
                                </p>
                                <p class="mb-2 pb-2 border-b border-gray-line">
                                    Fit:
                                    <span class="font-semibold">Regular</span>
                                </p>
                                <p class="mb-2 pb-2 border-b border-gray-line">
                                    Length:
                                    <span class="font-semibold">Standard</span>
                                </p>
                                <p class="mb-2">
                                    Sleeve length:
                                    <span class="font-semibold">Short sleeves</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div id="additional-info-content" role="tabpanel" aria-labelledby="additional-info-tab"
                        class="tab-content hidden">
                        <p>Additional information about the product.</p>
                        <div class="flex flex-col space-y-8">
                            <div>
                                <h3 class="text-lg font-semibold mb-2">
                                    Colors
                                </h3>
                                <p class="text-base text-gray-700">
                                    Available colors:
                                    <a href="#" class="text-primary hover:underline">Red</a>,
                                    <a href="#" class="text-primary hover:underline">Blue</a>,
                                    <a href="#" class="text-primary hover:underline">Green</a>,
                                    <a href="#" class="text-primary hover:underline">Black</a>,
                                    <a href="#" class="text-primary hover:underline">White</a>.
                                </p>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold mb-2">
                                    Brand
                                </h3>
                                <p class="text-base text-gray-700">
                                    This t-shirt is made by
                                    <a href="#" class="text-primary hover:underline">Nike</a>.
                                </p>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold mb-2">
                                    Material & Care
                                </h3>
                                <p class="text-base text-gray-700">
                                    Material: 100% Cotton
                                    <br />
                                    Care instructions: Machine wash at 40 °C, do
                                    not tumble dry, iron at medium temperature,
                                    do not bleach.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div id="size-shape-content" role="tabpanel" aria-labelledby="size-shape-tab"
                        class="tab-content hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white">
                                <thead>
                                    <tr>
                                        <th
                                            class="px-6 py-3 border-b border-gray-line bg-gray-100 text-left text-xs leading-4 font-medium text-gray-700 uppercase tracking-wider">
                                            Size
                                        </th>
                                        <th
                                            class="px-6 py-3 border-b border-gray-line bg-gray-100 text-left text-xs leading-4 font-medium text-gray-700 uppercase tracking-wider">
                                            Chest (inches)
                                        </th>
                                        <th
                                            class="px-6 py-3 border-b border-gray-line bg-gray-100 text-left text-xs leading-4 font-medium text-gray-700 uppercase tracking-wider">
                                            Waist (inches)
                                        </th>
                                        <th
                                            class="px-6 py-3 border-b border-gray-line bg-gray-100 text-left text-xs leading-4 font-medium text-gray-700 uppercase tracking-wider">
                                            Sleeve Length (inches)
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            Small
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            34-36
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            28-30
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            32-33
                                        </td>
                                    </tr>
                                    <tr>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            Medium
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            38-40
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            32-34
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            33-34
                                        </td>
                                    </tr>
                                    <tr>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            Large
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            42-44
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            36-38
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            34-35
                                        </td>
                                    </tr>
                                    <tr>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            X-Large
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            46-48
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            40-42
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-no-wrap border-b border-gray-line text-sm leading-5 text-gray-700">
                                            35-36
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="reviews-content" role="tabpanel" aria-labelledby="reviews-tab" class="tab-content hidden">
                        <!-- Reviews List -->
                        <div class="space-y-6">
                            <h3 class="text-lg font-semibold mb-4">
                                Customer Reviews
                            </h3>
                            <div id="reviews-list" data-product-id="{{product.id}}">
                                <!-- Hiển thị các reviews -->
                            </div>
                            <div id="reviews-pagination" class="flex gap-2 mt-4">
                                <!-- Hiển thị nút phân trang -->
                            </div>
                        </div>

                        <!-- Submit Review Form -->
                        <div id="review-form-place" class="mt-8">
                            <h3 class="text-lg font-semibold mb-4">
                                Write a Review
                            </h3>
                            <form id="review-form" method="post" action="/shop/product/{{product.id}}/post-review"
                                class="space-y-4">
                                <div class="space-y-4 md:flex md:space-x-4 md:space-y-0">
                                    <div class="md:flex-1">
                                        <label for="review-name"
                                            class="block text-sm font-medium text-gray-700">Name</label>
                                        <input type="text" id="review-name" name="name"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" />
                                    </div>
                                    <div class="md:flex-1">
                                        <label for="review-email"
                                            class="block text-sm font-medium text-gray-700">Email</label>
                                        <input type="email" id="review-email" name="email"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm" />
                                    </div>
                                    <div class="md:flex-1">
                                        <label for="review-rating"
                                            class="block text-sm font-medium text-gray-700">Rating</label>
                                        <select id="review-rating" name="rating"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                                            <option value="5">
                                                ★★★★★
                                            </option>
                                            <option value="4">
                                                ★★★★☆
                                            </option>
                                            <option value="3">
                                                ★★★☆☆
                                            </option>
                                            <option value="2">
                                                ★★☆☆☆
                                            </option>
                                            <option value="1">
                                                ★☆☆☆☆
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label for="review-text"
                                        class="block text-sm font-medium text-gray-700">Review</label>
                                    <textarea id="review-text" name="comment" rows="4"
                                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"></textarea>
                                </div>
                                <div>
                                    <button type="submit"
                                        class="bg-primary hover:bg-transparent border border-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full focus:outline-none">
                                        Submit Review
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related products section -->
{{#if product.relatedProducts}}
<section id="latest-products" class="py-10">
    <div class="container mx-auto px-4">
        <h2 class="text-2xl font-bold mb-8">Related products</h2>
        <div class="flex flex-wrap -mx-4">
            <!-- Related products -->
            {{#each product.relatedProducts}}
            <div class="w-full sm:w-1/2 lg:w-1/4 px-4 mb-8">
                <div class="bg-white p-3 rounded-lg shadow-lg">
                    <a href="/shop/product/{{id}}"><img src="{{imageUrl}}" alt="Product 1"
                            class="w-full object-cover mb-4 rounded-lg" /></a>
                    <a href="/shop/product/{{id}}" class="text-lg font-semibold mb-2">{{product_name}}</a>
                    <p class="my-2">{{category}}</p>
                    <div class="flex items-center mb-4">
                        <span class="text-lg font-bold text-primary">${{price}}</span>
                    </div>
                    <button
                        class="bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full w-full">
                        Add to Cart
                    </button>
                </div>
            </div>
            {{/each}}
        </div>
    </div>
</section>
{{/if}}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const reviewsList = document.getElementById("reviews-list");
        const paginationControls = document.getElementById("reviews-pagination");
        const productId = reviewsList.dataset.productId; // Lấy product ID từ dataset
        let currentPage = 1;

        // Hàm tải reviews
        async function loadReviews(page) {
            try {
                const response = await fetch(`/shop/product/${productId}/api/reviews?page=${page}`);
                const data = await response.json();

                if (response.ok) {
                    // Xóa danh sách cũ
                    reviewsList.innerHTML = "";

                    // Render reviews
                    if (data.reviews.length) {
                        data.reviews.forEach((review) => {
                            const reviewHTML = `
                        <div class="border-b border-gray-line py-4">
                            <div class="flex items-center mb-2">
                                <span class="text-lg font-semibold text-gray-700">${review.customer_name}</span>
                                <span class="ml-2 text-primary">
                                    ${"★".repeat(review.rating)}${"☆".repeat(5 - review.rating)}
                                </span>
                                <span class="ml-6 text-xs">${new Date(review.created_at).toLocaleString()}</span>
                            </div>
                            <p>${review.comment}</p>
                        </div>`;
                            reviewsList.insertAdjacentHTML("beforeend", reviewHTML);
                        });

                        // Render pagination
                        renderPagination(data.totalPages, data.currentPage);
                    } else {
                        reviewsList.innerHTML = "<p>No reviews yet.</p>";
                    }
                } else {
                    console.error("Error loading reviews:", data.error);
                }
            } catch (error) {
                console.error("Error fetching reviews:", error);
            }
        }

        // Hàm render pagination
        function renderPagination(totalPages, currentPage) {
            paginationControls.innerHTML = ""; // Xóa các nút phân trang cũ

            if (totalPages < 2) return;

            const MAX_VISIBLE_PAGES = 3; // Số lượng nút hiển thị tối đa
            // Tạo nút "Prev"
            if (currentPage > 1) {
                const prevButton = document.createElement("button");
                prevButton.textContent = "Prev";
                prevButton.className = "px-3 py-1 border rounded-full hover:bg-primary hover:text-white";
                prevButton.addEventListener("click", () => {
                    loadReviews(currentPage - 1);
                });
                paginationControls.appendChild(prevButton);
            }

            // Xác định phạm vi hiển thị các nút
            let startPage = Math.max(1, currentPage - Math.floor(MAX_VISIBLE_PAGES / 2));
            let endPage = Math.min(totalPages, startPage + MAX_VISIBLE_PAGES - 1);

            // Điều chỉnh nếu phạm vi vượt quá giới hạn
            if (endPage - startPage + 1 < MAX_VISIBLE_PAGES) {
                startPage = Math.max(1, endPage - MAX_VISIBLE_PAGES + 1);
            }

            // Thêm dấu "..." trước các trang đầu
            if (startPage > 1) {
                const firstPageButton = document.createElement("button");
                firstPageButton.textContent = "1";
                firstPageButton.className = "px-3 py-1 border rounded-full hover:bg-primary hover:text-white";
                firstPageButton.addEventListener("click", () => {
                    loadReviews(1);
                });
                paginationControls.appendChild(firstPageButton);

                const dots = document.createElement("span");
                dots.textContent = "...";
                dots.className = "mx-2";
                paginationControls.appendChild(dots);
            }

            // Thêm các nút trong phạm vi
            for (let page = startPage; page <= endPage; page++) {
                const pageButton = document.createElement("button");
                pageButton.textContent = page;
                pageButton.className =
                    "px-3 py-1 border rounded-full" +
                    (page === currentPage ? " bg-primary text-white" : " hover:bg-primary hover:text-white");

                pageButton.addEventListener("click", () => {
                    loadReviews(page);
                });

                paginationControls.appendChild(pageButton);
            }

            // Thêm dấu "..." sau các trang cuối
            if (endPage < totalPages) {
                const dots = document.createElement("span");
                dots.textContent = "...";
                dots.className = "mx-2";
                paginationControls.appendChild(dots);

                const lastPageButton = document.createElement("button");
                lastPageButton.textContent = totalPages;
                lastPageButton.className = "px-3 py-1 border rounded-full hover:bg-primary hover:text-white";
                lastPageButton.addEventListener("click", () => {
                    loadReviews(totalPages);
                });
                paginationControls.appendChild(lastPageButton);
            }

            // Tạo nút "Next"
            if (currentPage < totalPages) {
                const nextButton = document.createElement("button");
                nextButton.textContent = "Next";
                nextButton.className = "px-3 py-1 border rounded-full hover:bg-primary hover:text-white";
                nextButton.addEventListener("click", () => {
                    loadReviews(currentPage + 1);
                });
                paginationControls.appendChild(nextButton);
            }
        }

        // Tải trang đầu tiên
        loadReviews(currentPage);
    });
</script>